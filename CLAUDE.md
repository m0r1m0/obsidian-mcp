# Obsidian MCP Server 開発仕様

## プロジェクト概要
ObsidianのノートファイルをMCP（Model Context Protocol）経由で操作するサーバーを開発する。
Claudeなどのクライアントから、Obsidianのvault内のノートファイルを検索・読み込み・作成・更新できる機能を提供する。

## 技術スタック
- **言語**: Node.js / TypeScript
- **プロトコル**: MCP (Model Context Protocol)
- **対象**: Obsidianのmarkdownファイル (.md)

## 機能要件

### 1. サーバー起動・設定
- サーバー起動時にObsidian vaultのパスをコマンドライン引数で指定
- 例: `npm start -- --vault-path /path/to/obsidian/vault`

### 2. 検索機能 (tools)
以下の検索方法を提供：
- **ファイル名検索**: ファイル名による部分一致検索
- **内容検索**: ノート内容の全文検索
- **タグ検索**: `#tag` 形式のタグによる検索
- **正規表現検索**: 正規表現パターンによる検索

#### 検索結果に含める情報
- ファイルパス（vault相対パス）
- ファイル名
- マッチした内容の抜粋
- 作成日時・更新日時
- ファイルサイズ
- タグ一覧
- マッチした行番号

### 3. 読み込み機能 (tools)
- 指定されたファイルパスのノート内容を全文取得
- メタデータ（frontmatter）も含めて取得

### 4. 作成・更新機能 (tools)
- **新規ノート作成**: 指定したパスに新しいmarkdownファイルを作成
- **既存ノート更新**: 既存ファイルの内容を全体置換で更新

## エラーハンドリング要件
以下のエラーケースに対する適切なエラーメッセージとハンドリング：
- 指定されたvaultパスが存在しない
- ファイルの読み書き権限がない
- 存在しないファイルを読み込もうとした

## パフォーマンス・制限
- 現時点では特別な制限は設けない
- 必要に応じて後から最適化を検討

## 提供するMCPツール一覧

### 1. search_notes
- **説明**: ノートを検索する
- **パラメータ**:
  - `query`: 検索クエリ
  - `search_type`: 検索タイプ ("filename" | "content" | "tag" | "regex")
- **戻り値**: 検索結果の配列（上記検索結果情報を含む）

### 2. read_note
- **説明**: 指定されたノートの内容を読み込む
- **パラメータ**:
  - `file_path`: 読み込むファイルのパス（vault相対パス）
- **戻り値**: ファイル内容（文字列）

### 3. create_note
- **説明**: 新しいノートを作成する
- **パラメータ**:
  - `file_path`: 作成するファイルのパス（vault相対パス）
  - `content`: ファイル内容
- **戻り値**: 作成成功メッセージ

### 4. update_note
- **説明**: 既存ノートの内容を更新する
- **パラメータ**:
  - `file_path`: 更新するファイルのパス（vault相対パス）
  - `content`: 新しいファイル内容
- **戻り値**: 更新成功メッセージ

## 実装上の注意事項
- TypeScriptの型定義を適切に設定
- 適切なログ出力を実装
- MCPプロトコルの仕様に準拠
- ファイルシステム操作は非同期で実装
- セキュリティを考慮し、vault外へのアクセスを制限

## 開発・テスト環境
- Node.js 22以上 (LTS)
- TypeScript 5以上
- 適切なpackage.jsonとtsconfig.jsonを設定
- MCPクライアントでのテストを可能にする

## 期待される成果物
- 完全に動作するMCPサーバー
- 適切なエラーハンドリング
- 型安全なTypeScript実装
- READMEファイル（セットアップ・使用方法を含む）